<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Performs a volatile read of the value from `src` without moving it. This leaves the memory in `src` unchanged."><meta name="keywords" content="rust, rustlang, rust-lang, read_volatile"><title>read_volatile in std::ptr - Rust</title><link rel="stylesheet" type="text/css" href="../../normalize1.56.1.css"><link rel="stylesheet" type="text/css" href="../../rustdoc1.56.1.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../light1.56.1.css" id="themeStyle"><link rel="stylesheet" type="text/css" href="../../dark1.56.1.css" disabled=""><link rel="stylesheet" type="text/css" href="../../ayu1.56.1.css" disabled=""><script id="default-settings"></script><script src="../../storage1.56.1.js"></script><script src="../../crates1.56.1.js"></script><noscript><link rel="stylesheet" href="../../noscript1.56.1.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x161.56.1.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x321.56.1.png"><link rel="icon" type="image/svg+xml" href="../../favicon1.56.1.svg"><style type="text/css">#crate-search{background-image:url("../../down-arrow1.56.1.svg");}</style></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../../std/index.html'><div class='logo-container rust-logo'><img src='../../rust-logo1.56.1.png' alt='logo'></div></a><div class="sidebar-elems"><h2 class="location">Other items in<br><a href="../index.html">std</a>::<wbr><a href="index.html">ptr</a></h2><div id="sidebar-vars" data-name="read_volatile" data-ty="fn" data-relpath=""></div><script defer="" src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../../brush1.56.1.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled="" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../../wheel1.56.1.svg"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Function <a href="../index.html">std</a>::<wbr><a href="index.html">ptr</a>::<wbr><a class="fn" href="#">read_volatile</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../clipboard1.56.1.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span class="since" title="Stable since Rust version 1.9.0">1.9.0</span><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../../src/core/ptr/mod.rs.html#1048" title="goto source code">[src]</a></span></h1><pre class="rust fn"><code>pub unsafe fn read_volatile&lt;T&gt;(src: <a class="primitive" href="../primitive.pointer.html">*const T</a>) -&gt; T</code></pre><details class="rustdoc-toggle top-doc" open=""><summary class="hideme"><span>Expand description</span></summary><div class="docblock" xpath="/html[1]/body[1]/section[1]/details[1]/div[1]" istranslationnode="true" main_mp="Y25yZD4/dHFyOzpzYWRgWmZ+fHBgfHhw" sub_mp="[&quot;c3VkOz51cHc6O3JkZWFbc399cWV9eXE=&quot;]"><p class="translate-text">从 src 执行易失性读取值而不移动它。 这使 src 中的内存保持不变。</p><p>Performs a volatile read of the value from <code>src</code> without moving it. This
leaves the memory in <code>src</code> unchanged.</p>
<p class="translate-text">易失性操作旨在作用于 I/O 内存，并保证编译器不会在其他易失性操作中忽略或重新排序。</p><p>Volatile operations are intended to act on I/O memory, and are guaranteed
to not be elided or reordered by the compiler across other volatile
operations.</p>
<h1 id="notes" class="section-header"><a href="#notes">Notes</a></h1>
<p class="translate-text">Rust 目前没有严格和正式定义的内存模型，因此“易失性”在这里的精确语义会随着时间而改变。 话虽如此，语义最终几乎总是与 C11 对 volatile 的定义非常相似。</p><p>Rust does not currently have a rigorously and formally defined memory model,
so the precise semantics of what “volatile” means here is subject to change
over time. That being said, the semantics will almost always end up pretty
similar to <a href="http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1570.pdf">C11’s definition of volatile</a>.</p>
<p class="translate-text">编译器不应更改易失性内存操作的相对顺序或数量。 但是，对零大小类型的易失性内存操作（例如，如果将零大小类型传递给 read_volatile）是 noops 并且可以被忽略。</p><p>The compiler shouldn’t change the relative order or number of volatile
memory operations. However, volatile memory operations on zero-sized types
(e.g., if a zero-sized type is passed to <code>read_volatile</code>) are noops
and may be ignored.</p>
<h1 id="safety" class="section-header"><a href="#safety">Safety</a></h1>
<p class="translate-text">如果违反以下任何条件，则行为未定义：</p><p>Behavior is undefined if any of the following conditions are violated:</p>
<ul>
<li class="translate-text">src 必须对读取有效。</li><li>
<p><code>src</code> must be <a href="index.html#safety">valid</a> for reads.</p>
</li>
<li class="translate-text">src 必须正确对齐。</li><li>
<p><code>src</code> must be properly aligned.</p>
</li>
<li class="translate-text">src 必须指向 T 类型的正确初始化值。</li><li>
<p><code>src</code> must point to a properly initialized value of type <code>T</code>.</p>
</li>
</ul>
<p class="translate-text">与 read 一样，read_volatile 创建 T 的按位副本，无论 T 是否为 Copy。 如果 T 不是 Copy，则同时使用返回值和 *src 处的值会违反内存安全。 但是，将非 Copy 类型存储在易失性内存中几乎肯定是不正确的。</p><p>Like <a href="fn.read.html" title="read"><code>read</code></a>, <code>read_volatile</code> creates a bitwise copy of <code>T</code>, regardless of
whether <code>T</code> is <a href="../marker/trait.Copy.html" title="Copy"><code>Copy</code></a>. If <code>T</code> is not <a href="../marker/trait.Copy.html" title="Copy"><code>Copy</code></a>, using both the returned
value and the value at <code>*src</code> can <a href="fn.read.html#ownership-of-the-returned-value">violate memory safety</a>.
However, storing non-<a href="../marker/trait.Copy.html" title="Copy"><code>Copy</code></a> types in volatile memory is almost certainly
incorrect.</p>
<p class="translate-text">请注意，即使 T 的大小为 0，指针也必须非空且正确对齐。</p><p>Note that even if <code>T</code> has size <code>0</code>, the pointer must be non-null and properly aligned.</p>
<p class="translate-text">就像在 C 中一样，一个操作是否是 volatile 与涉及来自多个线程的并发访问的问题没有任何关系。 在这方面，易失性访问的行为与非原子访问完全相同。 特别是， read_volatile 和对同一位置的任何写入操作之间的竞争是未定义的行为。</p><p>Just like in C, whether an operation is volatile has no bearing whatsoever
on questions involving concurrent access from multiple threads. Volatile
accesses behave exactly like non-atomic accesses in that regard. In particular,
a race between a <code>read_volatile</code> and any write operation to the same location
is undefined behavior.</p>
<h1 id="examples" class="section-header"><a href="#examples">Examples</a></h1>
<p class="translate-text">基本用法：</p><p>Basic usage:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let</span> <span class="ident">x</span> <span class="op">=</span> <span class="number">12</span>;
<span class="kw">let</span> <span class="ident">y</span> <span class="op">=</span> <span class="kw-2">&amp;</span><span class="ident">x</span> <span class="kw">as</span> <span class="kw-2">*</span><span class="kw">const</span> <span class="ident">i32</span>;

<span class="kw">unsafe</span> {
    <span class="macro">assert_eq!</span>(<span class="ident">std::ptr::read_volatile</span>(<span class="ident">y</span>), <span class="number">12</span>);
}</code></pre><a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=%23!%5Ballow(unused)%5D%0Afn%20main()%20%7B%0Alet%20x%20%3D%2012%3B%0Alet%20y%20%3D%20%26x%20as%20*const%20i32%3B%0A%0Aunsafe%20%7B%0A%20%20%20%20assert_eq!(std%3A%3Aptr%3A%3Aread_volatile(y)%2C%2012)%3B%0A%7D%0A%7D&amp;edition=2018">Run</a></div>
</div></details></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../../" data-current-crate="std" data-search-index-js="../../search-index1.56.1.js" data-search-js="../../search1.56.1.js"></div>
    <script src="../../main1.56.1.js"></script>
</body></html>